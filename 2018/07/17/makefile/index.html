<html>
<head><meta name="generator" content="Hexo 3.9.0">
	
	<title>初见Makefile</title>
	<meta name="keywords" content="howar.cn">

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
	   <link href="/css/main.css?v=3" rel="stylesheet" type="text/css">
    
        <script src="/js/util.js"></script>
        <script>
            if(isMobile()) {
                loadjscssfile('../css/mobile.css', 'css');
            } else {
                loadjscssfile('../css/desktop.css', 'css');
            }
        </script> 
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3">
    
    

</head>

<body>


<h2 class="title">初见Makefile</h2>
<!---
<div style="text-align:center;margin-top: -10px;">
<div class="article-category">
发表于2018年7月17日


    <a class="article-category-link" href="/categories/Linux/">Linux</a>



 </div>
--->
</div>

<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-makefile中包含什么"><span class="toc-text">1. makefile中包含什么</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-显示规则"><span class="toc-text">1.1 显示规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-隐晦规则"><span class="toc-text">1.2 隐晦规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-变量定义"><span class="toc-text">1.3 变量定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-文件指示"><span class="toc-text">1.4 文件指示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-注释"><span class="toc-text">1.5 注释</span></a></li></ol></li></ol>
<h2 id="1-makefile中包含什么"><a href="#1-makefile中包含什么" class="headerlink" title="1. makefile中包含什么"></a>1. makefile中包含什么</h2><p>&emsp;&emsp;Makefile中主要包含了五部分内容：显示规则、隐晦规则、变量定义、文件指示、注释。</p>
<h3 id="1-1-显示规则"><a href="#1-1-显示规则" class="headerlink" title="1.1 显示规则"></a>1.1 显示规则</h3><p>&emsp;&emsp;显式规则说明了，如何生成一个或多个的目标文件。这是由Makefile的书写者明显指出，要生成的文件，文件的依赖文件，生成的命令。如下所示：</p>
<pre><code>main.o : main.c defs.h
    cc -c main.c</code></pre><p>&emsp;&emsp;显示的指出目标、目标的依赖、已经生成目标的命令。</p>
<h3 id="1-2-隐晦规则"><a href="#1-2-隐晦规则" class="headerlink" title="1.2 隐晦规则"></a>1.2 隐晦规则</h3><p>&emsp;&emsp;GNU的make很强大，它可以自动推导文件以及文件依赖关系后面的命令，于是我们就没必要去在每一个[.o]文件后都写上类似的命令，因为，我们的make会自动识别，并自己推导命令。</p>
<p>&emsp;&emsp;只要make看到一个[.o]文件，它就会自动的把[.c]文件加在依赖关系中，如果make找到一个whatever.o，那么whatever.c，就会是whatever.o的依赖文件。并且 cc -c whatever.c 也会被推导出来，于是，我们的makefile再也不用写得这么复杂。我们的是新的makefile又出炉了。</p>
<p>&emsp;&emsp;所以，可以有一下makefile：</p>
<pre><code>objects = main.o kbd.o command.o display.o insert.o search.o files.o utils.o

edit : $(objects)
    cc -o edit $(objects)

main.o : defs.h
kbd.o : defs.h command.h
command.o : defs.h command.h
display.o : defs.h buffer.h
insert.o : defs.h buffer.h
search.o : defs.h buffer.h
files.o : defs.h buffer.h command.h
utils.o : defs.h</code></pre><h3 id="1-3-变量定义"><a href="#1-3-变量定义" class="headerlink" title="1.3 变量定义"></a>1.3 变量定义</h3><p>&emsp;&emsp;如上一小节中的“objects”即为定义的变量。</p>
<p>&emsp;&emsp;而Makefile中定义变量有四种方式：</p>
<p>&emsp;&emsp;<strong>立即赋值</strong>：a:=b。会立即计算b的值，并赋值给a。如：</p>
<pre><code>var1:=$(var2) bar
var2:=foo</code></pre><p>&emsp;&emsp;则var1的值就为”bar”。</p>
<p>&emsp;&emsp;<strong>延迟赋值</strong>：a=b。相当于C++和java的引用。如果后面b的值改变了，那么a的值也会改变。如：</p>
<pre><code>var1=$(var2) bar
var2:=foo</code></pre><p>&emsp;&emsp;var1的值就为”foo bar”。</p>
<p>&emsp;&emsp;<strong>条件赋值</strong>：a?=b。如果a没有定义，则相当于a=b ，否则不执行任何操作。</p>
<p>&emsp;&emsp;<strong>附加赋值</strong>：a+=b。将b的值添加到a原有的值后面，再赋值给a。如：</p>
<pre><code>var1=func1.o func2.0
var2+=$(var1) func3.o</code></pre><p>&emsp;&emsp;则var2的值为”func1.o func2.o func3.o”。</p>
<h3 id="1-4-文件指示"><a href="#1-4-文件指示" class="headerlink" title="1.4 文件指示"></a>1.4 文件指示</h3><p>&emsp;&emsp;主要分三部分：</p>
<p>&emsp;&emsp;a. 在makefile中引用另一个makefile，就像c语言中的include一样；</p>
<p>&emsp;&emsp;b. 根据某些情况指定Makefile中的有效部分，就像C语言中的预编译#if一样；</p>
<p>&emsp;&emsp;c. 定义一个多行的命令。</p>
<h3 id="1-5-注释"><a href="#1-5-注释" class="headerlink" title="1.5 注释"></a>1.5 注释</h3><p>&emsp;&emsp;Makefile中只有行注释，和UNIX的Shell脚本一样，其注释是用“#”字符，这个就像C/C++中的“//”一样。如果你要在你的Makefile中使用“#”字符，可以用反斜框进行转义，如：“/#”。</p>


<!--<a href="http://www.howar.cn/2018/07/17/makefile/#disqus_thread" class="article-comment-link">Comments</a>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->
<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script>
</div>






</body>
</html>