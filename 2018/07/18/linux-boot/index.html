<html>
<head><meta name="generator" content="Hexo 3.9.0">
	
	<title>简析linux启动流程</title>
	<meta name="keywords" content="howar.cn">

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
	   <link href="/css/main.css?v=3" rel="stylesheet" type="text/css">
    
        <script src="/js/util.js"></script>
        <script>
            if(isMobile()) {
                loadjscssfile('../css/mobile.css', 'css');
            } else {
                loadjscssfile('../css/desktop.css', 'css');
            }
        </script> 
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3">
    
    

</head>

<body>


<h2 class="title">简析linux启动流程</h2>
<!---
<div style="text-align:center;margin-top: -10px;">
<div class="article-category">
发表于2018年7月18日


    <a class="article-category-link" href="/categories/Linux/">Linux</a>



 </div>
--->
</div>

<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-硬件启动流程"><span class="toc-text">1. 硬件启动流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-GRUB启动引导"><span class="toc-text">2. GRUB启动引导</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-内核引导阶段"><span class="toc-text">3. 内核引导阶段</span></a></li></ol>
<p>本文以x86 PC为例，简要介绍linux启动流程。</p>
<h2 id="1-硬件启动流程"><a href="#1-硬件启动流程" class="headerlink" title="1. 硬件启动流程"></a>1. 硬件启动流程</h2><p>当PC上电后，需要根据PC寄存器的值进行取值执行。那么上电后PC寄存器的值会是多少呢？答案是BIOS映射区。</p>
<p>BIOS即基本输入输出系统，主要完成两部分工作：<br></p>
<ul>
<li>POST，即上电自检。初始化硬件设备，并检查系统外围主要设备，如内存、键盘、显示器、软硬磁盘等；<br></li>
<li>确定启动设备。根据设置的启动顺序，检测驱动器，将磁盘的0磁道0扇区扇区拷贝（512B）到内存（该扇区即引导扇区，其中存放的是MBR即主引导记录）。然后将控制权转交给MBR中的Bootloader。<blockquote>
<p>其中磁盘0磁道0扇区即引导扇区，其中存放的是MBR即主引导扇区。其中主要包含两部分内容：</p>
<ul>
<li>Bootloader的stage1</li>
<li>硬盘分区表DDT和魔数</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="2-GRUB启动引导"><a href="#2-GRUB启动引导" class="headerlink" title="2. GRUB启动引导"></a>2. GRUB启动引导</h2><p>这部分的启动主要分为三个阶段：stage1、stage1.5、stage2。</p>
<p><strong>1. stage1</strong></p>
<p>如上述介绍，这部分代码存放于MBR中，其重要作用是启动装载stage2。</p>
<p><strong>2. stage1.5</strong></p>
<p>这部分代码存放在MBR后面的分区。它能识别启动分区文件系统，是stage1和stage2的桥梁，访问/boot分区grub目录下的stage2文件，并载入内存。</p>
<p><strong>3 stage2</strong></p>
<p>这部分启动代码的主要作用为：</p>
<ul>
<li>能够解析grub的配置文件，位于/boot分区下的/grub/grub.conf</li>
<li>显示操作系统的启动菜单</li>
<li>加载内核镜像到北村</li>
<li>通过/boot/initrd开头文件建立虚拟操作系统</li>
<li>将控制权转交给内核</li>
</ul>
<h2 id="3-内核引导阶段"><a href="#3-内核引导阶段" class="headerlink" title="3. 内核引导阶段"></a>3. 内核引导阶段</h2><p>经过上述过程后开始进入内核引导阶段：</p>
<ul>
<li>调用虚拟文件系统中的init</li>
<li>加载驱动模块，初始化并配置系统中的歌模块</li>
<li>加载并切换真正的文件系统</li>
<li>协助内核呼叫进程/sbin/init程序</li>
</ul>
<hr>
<p>经历上上述各阶段启动和引导后，开始进行系统初始化和启动终端，整个linux系统完成启动。</p>


<!--<a href="http://www.howar.cn/2018/07/18/linux-boot/#disqus_thread" class="article-comment-link">Comments</a>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->
<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script>
</div>






</body>
</html>