---
title: 简析linux启动流程
date: 2018-07-18 18:13:48
categories: Linux
tags: bootup
---


本文以x86 PC为例，简要介绍linux启动流程。
## 1. 硬件启动流程
当PC上电后，需要根据PC寄存器的值进行取值执行。那么上电后PC寄存器的值会是多少呢？答案是BIOS映射区。

BIOS即基本输入输出系统，主要完成两部分工作：<br />
- POST，即上电自检。初始化硬件设备，并检查系统外围主要设备，如内存、键盘、显示器、软硬磁盘等；<br />
- 确定启动设备。根据设置的启动顺序，检测驱动器，将磁盘的0磁道0扇区扇区拷贝（512B）到内存（该扇区即引导扇区，其中存放的是MBR即主引导记录）。然后将控制权转交给MBR中的Bootloader。
> 其中磁盘0磁道0扇区即引导扇区，其中存放的是MBR即主引导扇区。其中主要包含两部分内容：
> + Bootloader的stage1
> + 硬盘分区表DDT和魔数

## 2. GRUB启动引导
这部分的启动主要分为三个阶段：stage1、stage1.5、stage2。

**1. stage1**

如上述介绍，这部分代码存放于MBR中，其重要作用是启动装载stage2。

**2. stage1.5**

这部分代码存放在MBR后面的分区。它能识别启动分区文件系统，是stage1和stage2的桥梁，访问/boot分区grub目录下的stage2文件，并载入内存。

**3 stage2**

这部分启动代码的主要作用为：
- 能够解析grub的配置文件，位于/boot分区下的/grub/grub.conf
- 显示操作系统的启动菜单
- 加载内核镜像到北村
- 通过/boot/initrd开头文件建立虚拟操作系统
- 将控制权转交给内核

## 3. 内核引导阶段
经过上述过程后开始进入内核引导阶段：
- 调用虚拟文件系统中的init
- 加载驱动模块，初始化并配置系统中的歌模块
- 加载并切换真正的文件系统
- 协助内核呼叫进程/sbin/init程序
---
经历上上述各阶段启动和引导后，开始进行系统初始化和启动终端，整个linux系统完成启动。
